(this["webpackJsonpreact-chess"]=this["webpackJsonpreact-chess"]||[]).push([[0],{113:function(e,t){},117:function(e,t,n){},118:function(e,t,n){},119:function(e,t,n){},120:function(e,t,n){},121:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(25),c=n.n(o),i=(n(76),n(77),n(2)),s=(n(78),n(18)),u=function(e){return r.a.createElement("div",{className:"home-page"},r.a.createElement("header",{className:"section-header"},r.a.createElement("h1",{className:"header-primary"},"React Chess Game")),r.a.createElement("main",{className:"section-main"},r.a.createElement("nav",{className:"navigation"},r.a.createElement("ul",{className:"navigation__list"},r.a.createElement("li",{className:"navigation__item"},r.a.createElement(s.b,{className:"navigation__link",to:"/game?random=true"},"Play with random Player")),r.a.createElement("li",{className:"navigation__item"},r.a.createElement(s.b,{className:"navigation__link",to:"/game?random=false"},"Play with Friend"))))))},l=n(12),f=n(9),h=n(3),d=(n(83),n(38)),m=n.n(d),p=n(13),v=n.n(p),b=n(56),y=n.n(b),E=n(57),g=n.n(E),k=n(58),O=n.n(k),_=n(59),w=n.n(_),j=n(60),M=n.n(j),S=n(61),N=n.n(S),T=n(62),C=n.n(T),R=n(63),D=n.n(R),P=n(64),x=n.n(P),B=n(65),L=n.n(B),q=n(66),A=n.n(q),I=n(67),W=n.n(I),G=n(68),H=n.n(G),K=function(e){var t="";switch(e.type){case"pawn":t=e.dark?O.a:g.a;break;case"bishop":t=e.dark?M.a:w.a;break;case"king":t=e.dark?C.a:N.a;break;case"queen":t=e.dark?x.a:D.a;break;case"rook":t=e.dark?H.a:W.a;break;case"knight":t=e.dark?A.a:L.a}return r.a.createElement("img",{src:t,alt:"pawn",className:y.a.Piece})},U="WHITE",X="BLACK",J=function(e){var t=[v.a.Square];return e.isLight?t.push(v.a.light):t.push(v.a.dark),"king"===e.pieceType&&(e.dark&&e.isChecked===X&&t.push(v.a.red),e.dark||e.isChecked!==U||t.push(v.a.red)),r.a.createElement("div",{className:t.join(" "),onClick:e.onClickHandler},e.pieceType&&r.a.createElement(K,{type:e.pieceType,dark:e.dark}),e.isPossible&&r.a.createElement("div",{className:v.a.Dot}))},V=function(e){for(var t=[],n=function(n){for(var a=[],o=function(t){var o,c;a.push(r.a.createElement(J,{pieceType:null===(o=e.squares[8*n+t])||void 0===o?void 0:o.type,index:8*n+t,dark:(null===(c=e.squares[8*n+t])||void 0===c?void 0:c.player)!==U,onClickHandler:function(){return e.onClickHandler(8*n+t)},isLight:Q(n)?Q(t):!Q(t),isPossible:e.possibleMoves.includes(8*n+t),isChecked:e.isChecked,key:""+n+t}))},c=0;c<8;c++)o(c);t.push(r.a.createElement("div",{className:m.a.Row,key:n},a))},a=0;a<8;a++)n(a);return e.player!==U&&t.reverse(),r.a.createElement("div",{className:m.a.Board},t)};function Q(e){return e%2===0}var F=n(69),Y=n.n(F)()("/"),Z=n(8),$=n(11),z=n(27),ee=n(14),te=n(15),ne=function(){function e(t){var n;Object(ee.a)(this,e),this.player=t,this.type="pawn",this.initialPositions=(n={},Object($.a)(n,U,[48,49,50,51,52,53,54,55]),Object($.a)(n,X,[8,9,10,11,12,13,14,15]),n)}return Object(te.a)(e,[{key:"toJSON",value:function(){return{player:this.player,type:this.type}}},{key:"isMovePossible",value:function(e,t,n){var a=!1,r=Math.floor(e/8),o=Math.floor(t/8),c=-1!==this.initialPositions[this.player].indexOf(e);return this.player===U&&((e-8===t||c&&e-16===t)&&!n&&(r-1===o||c&&r-2===o)&&(a=!0),e-9!==t&&e-7!==t||!n||r-1!==o||(a=!0)),this.player===X&&((e+8===t||c&&e+16===t)&&!n&&(r+1===o||c&&r+2===o)&&(a=!0),e+9!==t&&e+7!==t||!n||r+1!==o||(a=!0)),a}},{key:"pathToDestination",value:function(e,t){return t===e-16?[e-8]:t===e+16?[e+8]:[]}}]),e}(),ae=function(){function e(t){Object(ee.a)(this,e),this.player=t,this.type="rook"}return Object(te.a)(e,[{key:"isMovePossible",value:function(t,n){return e.checkRookMove(t,n)}},{key:"pathToDestination",value:function(t,n){return e.checkRookPath(t,n)}}],[{key:"checkRookMove",value:function(e,t){var n=Math.floor(e/8),a=Math.floor(t/8);return Math.abs(e-t)%8===0||n===a}},{key:"checkRookPath",value:function(e,t){var n=[],a=[e,t].sort((function(e,t){return t-e})),r=Object(f.a)(a,2),o=r[0],c=r[1],i=o-c;if(o-c<8)for(var s=i-1;s>=1;s--)n.push(o-s);else for(var u=i-8;u>=8;u-=8)n.push(o-u);return n}}]),e}(),re=function(){function e(t){Object(ee.a)(this,e),this.player=t,this.type="bishop"}return Object(te.a)(e,[{key:"isMovePossible",value:function(t,n){return e.checkBishopMove(t,n)}},{key:"pathToDestination",value:function(t,n){return e.checkBishopPath(t,n)}}],[{key:"checkBishopMove",value:function(e,t){var n=e%8,a=Math.floor(e/8),r=t%8,o=Math.floor(t/8);return n+a===r+o||(n-a===r-o||void 0)}},{key:"checkBishopPath",value:function(e,t){var n,a,r,o=[];e>t?(n=t,a=e):(n=e,a=t),Math.abs(e-t)%9===0?(r=9,n+=9):(r=7,n+=7);for(var c=n;c<a;c+=r)o.push(c);return o}}]),e}(),oe=function(){function e(t){Object(ee.a)(this,e),this.player=t,this.type="knight"}return Object(te.a)(e,[{key:"isMovePossible",value:function(e,t){var n=!1,a=e%8,r=Math.floor(e/8),o=t%8;switch(8*Math.floor(t/8)+o){case 8*(r-2)+(a-1):case 8*(r-2)+(a+1):case 8*(r-1)+(a-2):case 8*(r-1)+(a+2):case 8*(r+1)+(a-2):case 8*(r+1)+(a+2):case 8*(r+2)+(a-1):case 8*(r+2)+(a+1):n=!0;break;default:n=!1}return Math.abs(o-a)>2&&(n=!1),n}},{key:"pathToDestination",value:function(){return[]}}]),e}(),ce=function(){function e(t){Object(ee.a)(this,e),this.player=t,this.type="queen"}return Object(te.a)(e,[{key:"isMovePossible",value:function(e,t){return ae.checkRookMove(e,t)||re.checkBishopMove(e,t)}},{key:"pathToDestination",value:function(e,t){return ae.checkRookMove(e,t)?ae.checkRookPath(e,t):re.checkBishopPath(e,t)}}]),e}(),ie=function(){function e(t){Object(ee.a)(this,e),this.player=t,this.type="king"}return Object(te.a)(e,[{key:"isMovePossible",value:function(e,t){var n=!1,a=e%8,r=Math.floor(e/8),o=t%8;switch(8*Math.floor(t/8)+o){case 8*(r+1)+a:case 8*r+(a+1):case 8*(r+1)+(a-1):case 8*(r-1)+(a+1):case 8*(r+1)+(a+1):case 8*(r-1)+(a-1):case 8*(r-1)+a:case 8*r+(a-1):n=!0;break;default:n=!1}return Math.abs(o-a)>2&&(n=!1),n}},{key:"pathToDestination",value:function(e,t){return[]}}]),e}(),se=function(e,t,n){var a,r=!0,o=e[t].pathToDestination(t,n),c=Object(z.a)(o);try{for(c.s();!(a=c.n()).done;){var i=a.value;r=r&&!e[i]}}catch(s){c.e(s)}finally{c.f()}return r},ue=function(e,t){var n=[];if(!e[t])return[];for(var a=0;a<e.length;a++){var r,o;(null===(r=e[t])||void 0===r?void 0:r.player)!==(null===(o=e[a])||void 0===o?void 0:o.player)&&(e[t].isMovePossible(t,a,Boolean(e[a]))&&se(e,t,a)&&n.push(a))}return n},le=function(e,t){var n,a=[],r=e.filter((function(e){return null!==e&&e.player===t})).map((function(t){return e.indexOf(t)})),o=Object(z.a)(r);try{for(o.s();!(n=o.n()).done;){var c=n.value;a.push(ue(e,c))}}catch(i){o.e(i)}finally{o.f()}return Object(l.a)(new Set(a.flat()))},fe=function(e,t){return e.includes(t)},he=function(e,t,n,a){var r=n===U?X:U,o=ue(e,t);return o=o.filter((function(n){var o=Object(l.a)(e);o[t]=null,o[n]=e[t];var c=le(o,r);return"king"===e[t].type?!fe(c,n):!fe(c,a)}))};function de(e){if(e)return e.map((function(e){if(!e)return null;switch(e.type){case"pawn":return new ne(e.player);case"bishop":return new re(e.player);case"knight":return new oe(e.player);case"rook":return new ae(e.player);case"queen":return new ce(e.player);case"king":return new ie(e.player);default:return null}}));for(var t=new Array(64).fill(null),n=9;n<17;n++)t[64-n]=new ne(U),t[n-1]=new ne(X);return t[0]=new ae(X),t[7]=new ae(X),t[56]=new ae(U),t[63]=new ae(U),t[32]=new ce(U),t[1]=new oe(X),t[6]=new oe(X),t[57]=new oe(U),t[62]=new oe(U),t[2]=new re(X),t[5]=new re(X),t[58]=new re(U),t[61]=new re(U),t[3]=new ce(X),t[4]=new ie(X),t[59]=new ce(U),t[60]=new ie(U),t}var me={board:[],whoMoves:U,enemy:X,player:null,selected:null},pe=function(e){var t;if(0===e.board.length)return{};var n=(t={},Object($.a)(t,U,null),Object($.a)(t,X,null),t);return e.board.forEach((function(e,t){"king"===(null===e||void 0===e?void 0:e.type)&&(n[e.player]=t)})),n},ve=function(e){return 0===e.board.length?[]:null!==e.selected?he(e.board,e.selected,e.whoMoves,pe(e)[e.whoMoves]):[]},be=function(e){return 0===e.board.length?null:0===function(e,t,n){var a,r=[],o=e.filter((function(e){return null!==e&&e.player===t})).map((function(t){return e.indexOf(t)})),c=Object(z.a)(o);try{for(c.s();!(a=c.n()).done;){var i=a.value;r.push(he(e,i,t,n))}}catch(s){c.e(s)}finally{c.f()}return r.flat()}(e.board,e.whoMoves,pe(e)[e.whoMoves]).length?"DONE":null},ye=function(e){return{type:"SELECT",selected:e}},Ee=function(e){var t=e.player,n=e.restoredBoardState,o=Object(Z.c)((function(e){return e.game.board})),c=Object(Z.c)((function(e){return e.game.whoMoves})),i=Object(Z.c)((function(e){return e.game.enemy})),s=Object(Z.c)((function(e){return e.game.player})),u=Object(Z.c)((function(e){return be(e.game)})),l=Object(Z.c)((function(e){return function(e){if(0===e.board.length)return null;var t=le(e.board,e.enemy);return fe(t,pe(e)[e.whoMoves])?e.whoMoves:null}(e.game)})),h=Object(Z.c)((function(e){return[e.game.selected,ve(e.game)]})),d=Object(f.a)(h,2),m=d[0],p=d[1],v=Object(Z.b)();Object(a.useEffect)((function(){0===o.length&&v(n?{type:"RESTORE_GAME",initialState:n}:function(e){return{type:"START_GAME",initialState:e}}());var e=function(e){var t=e.position,n=e.destination;console.log("moved"),v(function(e,t){return{type:"MOVE",position:e,destination:t}}(t,n))};return Y.on("move",e),function(){Y.off("move",e)}}),[v,o,n,c,i,s]),Object(a.useEffect)((function(){v(function(e){return{type:"SET_PLAYER",player:e}}(t))}),[v,t]),Object(a.useEffect)((function(){s===i&&Y.emit("updateBoardState",{board:o,whoMoves:c,enemy:i},(function(){}))}),[o,i,s,c]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(V,{squares:o,possibleMoves:p,onClickHandler:function(e){var t,n,a;"DONE"!==u&&s===c&&((null!==m||(null===(t=o[e])||void 0===t?void 0:t.player)!==c)&&((null===(n=o[e])||void 0===n?void 0:n.player)!==(null===(a=o[m])||void 0===a?void 0:a.player)||e===m)?e!==m&&p.includes(e)?Y.emit("move",{position:m,destination:e},(function(){})):v({type:"UNSELECT"}):v(ye(e)))},isChecked:l,player:s}),u&&r.a.createElement("div",null,"GAME ENDED: ",i===U?"WHITE":"BLACK"," ","WINS"))},ge=(n(117),n(118),function(e){var t=["chat__message"],n=["chat__author"];return"admin"===e.message.user&&t.push("chat__message-system"),"WHITE"===e.message.user&&n.push("chat__author-white"),"BLACK"===e.message.user&&n.push("chat__author-black"),r.a.createElement("div",{className:t.join(" ")},r.a.createElement("div",{className:n.join(" ")}),r.a.createElement("div",{className:"chat__text"},e.message.text))}),ke=(n(119),function(e){return r.a.createElement("h3",{className:"chat__header"},e.children)}),Oe=(n(120),function(e){var t=e.chatMessage,n=e.onChange,a=e.inputRef,o=e.onSend;e.messageEnd;return r.a.createElement("div",{className:"chat__controls"},r.a.createElement("input",{type:"text",className:"chat__input",value:t,onChange:n,onKeyDown:function(e){return"Enter"===e.key?o():null},ref:a}),r.a.createElement("button",{className:"btn chat__btn-send",onClick:o},"Send"))}),_e=function(e){var t=e.sendMessage,n=e.chatMessages,o=Object(a.useRef)(null),c=Object(a.useState)(""),i=Object(f.a)(c,2),s=i[0],u=i[1];console.log("chat render");var l=Object(a.useCallback)((function(e){u(e.target.value)}),[]),h=function(){return u("")};return Object(a.useEffect)((function(){var e=o.current.scrollHeight-o.current.clientHeight;o.current.scrollTo({top:e,behavior:"smooth"})}),[n]),r.a.createElement("div",{className:"chat"},r.a.createElement(ke,null,"Chat"),r.a.createElement("div",{className:"chat__messages",ref:o},n.map((function(e,t){return r.a.createElement(ge,{key:e+t,message:e})}))),r.a.createElement(Oe,{onSend:function(e){t(s,h)},onChange:l,chatMessage:s}))},we={connected:!1,error:!1,player:null,boardState:null,roomId:""},je=function(e,t){switch(t.type){case"CONNECTED":return Object(h.a)(Object(h.a)({},e),{},{connected:!0,player:t.player,boardState:t.boardState,roomId:t.roomId});case"DISCONNECTED":return Object(h.a)(Object(h.a)({},e),{},{connected:!1});case"ERROR":return Object(h.a)(Object(h.a)({},e),{},{error:t.error});default:throw new Error("GamePage ruducer Error")}},Me=function(e){var t=Object(a.useReducer)(je,we),n=Object(f.a)(t,2),o=n[0],c=n[1],i=Object(a.useState)([]),s=Object(f.a)(i,2),u=s[0],h=s[1],d=Object(a.useState)(),m=Object(f.a)(d,2),p=m[0],v=m[1];Object(a.useEffect)((function(){console.log("effect");var t=new URLSearchParams(e.location.search);return Y.emit("join",{room:t.get("room"),random:t.get("random")},(function(e){var t=e.error;t&&c({type:"ERROR",error:t})})),Y.on("connected",(function(e){var n=e.player,a=e.room,r=e.boardState;v({room:a,random:t.get("random")}),c({type:"CONNECTED",player:n,roomId:a,boardState:r||null})})),Y.on("disconnect",(function(){c({type:"DISCONNECTED"})})),function(){Y.emit("disconnect"),Y.off()}}),[e.location.search]);var b=Object(a.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};0!==e.trim().length&&Y.emit("sendMessage",e,(function(){t()}))}),[]);Object(a.useEffect)((function(){var e=function(e){h((function(t){return[].concat(Object(l.a)(u),[e])}))};return Y.on("message",e),function(){Y.off("message",e)}}),[u]);return o.error?r.a.createElement("div",{className:"error"},o.error):o.connected?r.a.createElement("div",{className:"game-page"},"false"===p.random?r.a.createElement("p",{className:"info"},"Give this link to your friend ",r.a.createElement("br",null),new URL(window.location.href).origin,"/game?room=",p.room):null,r.a.createElement(Ee,{player:o.player,restoredBoardState:o.boardState}),r.a.createElement(_e,{sendMessage:b,chatMessages:u})):r.a.createElement("div",{className:"error"},"Loading...")},Se=n(22),Ne=Object(Se.b)({game:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:me,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"START_GAME":return Object(h.a)(Object(h.a)({},e),{},{board:de()});case"RESTORE_GAME":return Object(h.a)(Object(h.a)({},e),{},{board:de(t.initialState.board),whoMoves:t.initialState.whoMoves,enemy:t.initialState.enemy,player:t.initialState.player,selected:null});case"MOVE":var n=Object(l.a)(e.board);return n[t.position]=null,n[t.destination]=e.board[t.position],Object(h.a)(Object(h.a)({},e),{},{board:n,whoMoves:e.enemy,enemy:e.whoMoves,selected:null});case"SET_PLAYER":return Object(h.a)(Object(h.a)({},e),{},{player:t.player});case"SELECT":return Object(h.a)(Object(h.a)({},e),{},{selected:t.selected});case"UNSELECT":return Object(h.a)(Object(h.a)({},e),{},{selected:null});default:return e}}}),Te=Object(Se.c)(Ne,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__());var Ce=function(){return r.a.createElement(Z.a,{store:Te},r.a.createElement("div",{className:"App"},r.a.createElement(i.c,null,r.a.createElement(i.a,{path:"/game",component:Me}),r.a.createElement(i.a,{path:"/",component:u}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(s.a,null,r.a.createElement(Ce,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},13:function(e,t,n){e.exports={Square:"Square_Square__6aoyQ",light:"Square_light__29v_f",dark:"Square_dark__1bs3x",red:"Square_red__cC21P",Dot:"Square_Dot__30IGp"}},38:function(e,t,n){e.exports={Board:"Board_Board__2sXpW",Row:"Board_Row__1mo_X"}},56:function(e,t,n){e.exports={Piece:"Piece_Piece__3hJZe"}},57:function(e,t,n){e.exports=n.p+"static/media/Pawn_White.d69014fb.svg"},58:function(e,t,n){e.exports=n.p+"static/media/Pawn_Dark.1c52d8c4.svg"},59:function(e,t,n){e.exports=n.p+"static/media/Bishop_White.09004fd2.svg"},60:function(e,t,n){e.exports=n.p+"static/media/Bishop_Dark.1f3b8d1a.svg"},61:function(e,t,n){e.exports=n.p+"static/media/King_White.250510ff.svg"},62:function(e,t,n){e.exports=n.p+"static/media/King_Dark.66e1bcad.svg"},63:function(e,t,n){e.exports=n.p+"static/media/Queen_White.4320a2dd.svg"},64:function(e,t,n){e.exports=n.p+"static/media/Queen_Dark.7b3e33e4.svg"},65:function(e,t,n){e.exports=n.p+"static/media/Knight_White.e6294efe.svg"},66:function(e,t,n){e.exports=n.p+"static/media/Knight_Dark.d39f1d02.svg"},67:function(e,t,n){e.exports=n.p+"static/media/Rook_White.095b1a06.svg"},68:function(e,t,n){e.exports=n.p+"static/media/Rook_Dark.96872a66.svg"},71:function(e,t,n){e.exports=n(121)},76:function(e,t,n){},77:function(e,t,n){},78:function(e,t,n){},83:function(e,t,n){}},[[71,1,2]]]);
//# sourceMappingURL=main.a2121c4d.chunk.js.map